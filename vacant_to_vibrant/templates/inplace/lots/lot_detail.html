{% extends "lots/base.html" %}
{% load files_tags i18n inplace_tags notes_tags organize_tags photos_tags %}

{% block title %}{{ block.super }} | {{ lot.address_line1 }}{% endblock %}

{% block lot_content %}
{{ block.super }}
<div class="details">
    <h3>Details</h3>
    <table>
        <tr>
            <th>{% trans "address line 1" %}:</th>
            <td>{{ lot.address_line1|default:"unknown" }}</td>
        </tr>
        <tr>
            <th>{% trans "zipcode" %}:</th>
            <td>{{ lot.postal_code|default:"unknown" }}</td>
        </tr>
        <tr>
            <th>{% trans "area" %}:</th>
            <td>
                {% if lot.billing_account %}
                according to the lot's billing account, this lot has an area of {{ lot.billing_account.land_area|floatformat:"-1"|default:"unknown" }} square feet
                {% elif lot.water_parcel %}
                according to the Water Department, this lot has an area of {{ lot.water_parcel.gross_area|floatformat:"-1"|default:"unknown" }} square feet
                {% else %}
                this lot has an area of {{ lot.parcel_area|floatformat:"-1"|default:"unknown" }} square feet
                {% endif %}
            </td>
        </tr>
        <tr>
            <th>{% trans "owner" %}:</th>
            <td>{{ lot.owner|default:"unknown" }}</td>
        </tr>
        <tr>
            <th>{% trans "billing account" %}:</th>
            <td>{{ lot.billing_account|default:"unknown" }}</td>
        </tr>

        {% if lot.violations.count > 0 %}
        <tr>
            <th>{% trans "violations" %}:</th>
            <td>
                {{ lot.violations.count }}:
                {% for violation in lot.violations.all %}
                {{ violation.violation_datetime|date:"SHORT_DATE_FORMAT" }}
                {{ violation.violation_type }}
                {% endfor %}
            </td>
        </tr>
        {% endif %}

        {% if lot.land_use_area %}
        <tr>
            <th>{% trans "land use" %}:</th>
            <td>
                According to the City Planning Commission:
                {{ lot.land_use_area.category }}, 
                {{ lot.land_use_area.subcategory }},
                {{ lot.land_use_area.description }}
            </td>
        </tr>
        {% endif %}

        {% if lot.city_council_district %}
        <tr>
            <th>{% trans "city council district" %}:</th>
            <td>
                {{ lot.city_council_district.label }}
                {% with member=lot.city_council_district.citycouncilmember_set.all.0 %}
                <a href="{{ member.url }}">{{ member.name }}</a>
                {% endwith %}
            </td>
        </tr>
        {% endif %}

        {% if lot.zoning_district %}
        <tr>
            <th>{% trans "zoning district" %}:</th>
            <td>
                {{ lot.zoning_district.zoning_type.code }}
            </td>
        </tr>
        {% endif %}

        {% if lot.available_property %}
        <tr>
            <th>{% trans "available" %}:</th>
            <td>
                Available for purchase from {{ lot.available_property.agency }}
                price: {{ lot.available_property.price_str }}
            </td>
        </tr>
        {% endif %}

        {% if lot.tax_account %}
        <tr>
            <th>{% trans "tax account" %}:</th>
            <td>
                {{ lot.tax_account|default:"unknown" }}<br />
                {{ lot.tax_account.years_delinquent }} years delinquent<br />
                ${{ lot.tax_account.amount_delinquent }} delinquent
            </td>
        </tr>
        {% endif %}

        <tr>
            <th>{% trans "parcel" %}:</th>
            <td>{{ lot.parcel|default:"unknown" }}</td>
        </tr>

        {% if lot.water_parcel %}
        <tr>
            <th>{% trans "water parcel" %}:</th>
            <td>
                gross area: {{ lot.water_parcel.gross_area|floatformat }} square feet<br />
                impervious area: {{ lot.water_parcel.impervious_area|floatformat }} square feet<br />
                permeable area: {{ lot.water_parcel.percent_permeable|floatformat }}%<br />
                owners: {{ lot.water_parcel.owner1 }},
                {{lot.water_parcel.owner2}}
            </td>
        </tr>
        {% endif %}

    </table>
</div>

<div id="organizers" class="organize">
    <h3>Organize</h3>
    <a href="{% url "lots:add_organizer" pk=lot.pk %}">click to organize</a>
    {% render_organizer_list for lot %}
</div>

<div class="watch">
    <h3>Watch</h3>
    <a href="{% url "lots:add_watcher" pk=lot.pk %}">click to watch</a>
</div>

<div id="photos" class="photos">
    <h3>Photos</h3>
    <div>
        <a href="{% url "lots:add_photo" pk=lot.pk %}">click to add a photo</a>
    </div>
    {% render_photo_list for lot %}
</div>

<div id="notes" class="notes">
    <h3>Notes</h3>
    <a href="{% url "lots:add_note" pk=lot.pk %}">click to add a note</a>
    {% render_note_list for lot %}
</div>

<div id="files" class="files">
    <h3>Files</h3>
    <a href="{% url "lots:add_file" pk=lot.pk %}">click to add a file</a>
    {% render_file_list for lot %}
</div>

<div id="survey" class="survey">
    <h3>Survey</h3>
    <form action="{% url "survey_submit" pk=form.form.pk %}" class="survey-form" method="post">
        {% csrf_token %}
        {{ form.as_p }}
        <input type="submit" value="Update" />
    </form>
</div>

{% endblock %}
