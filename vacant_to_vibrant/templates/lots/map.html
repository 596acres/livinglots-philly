{% load inplace_tags %}
<!doctype html>
<html>
    <head>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

        <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.5.1/leaflet.css" />
        <!--[if lte IE 8]>
            <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.5.1/leaflet.ie.css" />
        <![endif]-->
        <script src="http://cdn.leafletjs.com/leaflet-0.5.1/leaflet.js"></script>
        <script src="{{ STATIC_URL }}js/Leaflet.Bing.js"></script>
        <script src="{{ STATIC_URL }}js/leaflet.utfgrid.js"></script>
        <script src="{{ STATIC_URL }}js/leaflet.lotmap.js"></script>

        <script>
        $(document).ready(function() {
            var map = L.map('map', {
                center: [39.952335, -75.163789],
                zoom: 13,
                cloudmadeKey: '{% inplace_setting PLACES_CLOUDMADE_KEY %}',
                cloudmadeStyleId: '{% inplace_setting PLACES_CLOUDMADE_STYLE %}',
                bingKey: 'ArBLp_jhvmrzT5Kg4_FXohJCKjbKmBW-nEEItp2dbceyHrJPMJJEqXDp8XsPy_cr',
                enableLayersControl: true,
                lotGridBaseUrl: 'http://localhost:8081/lots_grid/',
                lotGridResolution: 8,
                lotTilesBaseUrl: 'http://localhost:8081/lots/',
                lotClickHandler: function(e) {
                    if (!e.data) { return false; }
                    var popup = L.popup({
                        minWidth: 300,
                    })
                        .setLatLng(e.latlng)
                        .setContent('<div id="popup-content"></div>')
                        .openOn(map);
                    $.get('/places/lots/lot/' + e.data.id + '/popup/', function(response) {
                        $('#popup-content').html(response);
                    });
                },
            });
        });
        </script>
    </head>
    <body>
        <div id="map" style="width: 100%; height: 300px;"></div>
    </body>
</html>
